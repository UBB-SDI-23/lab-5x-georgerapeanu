<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-latest.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">
    <changeSet author="georgerapeanu (generated)" id="1680067598531-1">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="50" maxValue="9223372036854775807" minValue="1" sequenceName="manufacturer_seq" startValue="1"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-2">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="50" maxValue="9223372036854775807" minValue="1" sequenceName="product_seq" startValue="1"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-3">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="50" maxValue="9223372036854775807" minValue="1" sequenceName="productdto_seq" startValue="1"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-4">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="50" maxValue="9223372036854775807" minValue="1" sequenceName="review_seq" startValue="1"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-5">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="50" maxValue="9223372036854775807" minValue="1" sequenceName="reviews_seq" startValue="1"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-6">
        <createSequence cacheSize="1" cycle="false" dataType="bigint" incrementBy="50" maxValue="9223372036854775807" minValue="1" sequenceName="user_seq" startValue="1"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-7">
        <createTable tableName="manufacturer">
            <column name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="manufacturer_pkey"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="register_date" type="date"/>
        </createTable>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-8">
        <createTable tableName="product">
            <column name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="product_pkey"/>
            </column>
            <column name="description" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="price" type="FLOAT8"/>
            <column name="publish_date" type="date"/>
            <column name="weight" type="INTEGER"/>
            <column name="manufacturer_id" type="INTEGER">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-9">
        <createTable tableName="review">
            <column name="comment" type="VARCHAR(255)"/>
            <column name="posted_date" type="date"/>
            <column name="score" type="INTEGER"/>
            <column name="product_id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="review_pk"/>
            </column>
            <column name="user_id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="review_pk"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-10">
        <createTable tableName="user">
            <column name="id" type="INTEGER">
                <constraints nullable="false" primaryKey="true" primaryKeyName="user_pkey"/>
            </column>
            <column name="birthday" type="date"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="handle" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="registered_at" type="date"/>
        </createTable>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-11">
        <addForeignKeyConstraint baseColumnNames="product_id" baseTableName="review" constraintName="FK8ldiblkvx92d9i5yn9qqeuk8j" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="product" validate="true"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-12">
        <addForeignKeyConstraint baseColumnNames="manufacturer_id" baseTableName="product" constraintName="FK9it4492m5g5mttbvqy9dd2ngh" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="manufacturer" validate="true"/>
    </changeSet>
    <changeSet author="georgerapeanu (generated)" id="1680067598531-13">
        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="review" constraintName="FKp62gdxif9h9dtdwcyf5b7gdi8" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="user" validate="true"/>
    </changeSet>
    <changeSet id="1680067598532-1" author="georgerapeanu">
        <dropSequence sequenceName="manufacturer_seq"/>
        <dropSequence sequenceName="product_seq"/>
        <dropSequence sequenceName="productdto_seq"/>
        <dropSequence sequenceName="review_seq"/>
        <dropSequence sequenceName="reviews_seq"/>
        <dropSequence sequenceName="user_seq"/>
    </changeSet>
    <changeSet id="1680067598532-2" author="georgerapeanu">
        <addAutoIncrement tableName="manufacturer" columnName="id"/>
        <addAutoIncrement tableName="product" columnName="id"/>
        <addAutoIncrement tableName="user" columnName="id"/>
    </changeSet>
    <changeSet id="1680067598533-1" author="georgerapeanu">
        <dropForeignKeyConstraint baseTableName="review" constraintName="FK8ldiblkvx92d9i5yn9qqeuk8j"/>
        <dropForeignKeyConstraint baseTableName="product" constraintName="FK9it4492m5g5mttbvqy9dd2ngh"/>
        <dropForeignKeyConstraint baseTableName="review" constraintName="FKp62gdxif9h9dtdwcyf5b7gdi8"/>

        <dropPrimaryKey tableName="manufacturer"/>
        <dropNotNullConstraint tableName="manufacturer" columnName="id"/>

        <dropPrimaryKey tableName="product"/>
        <dropNotNullConstraint tableName="product" columnName="id"/>
        <dropNotNullConstraint tableName="product" columnName="manufacturer_id"/>

        <dropPrimaryKey tableName="review"/>
        <dropNotNullConstraint tableName="review" columnName="user_id"/>
        <dropNotNullConstraint tableName="review" columnName="product_id"/>

        <dropPrimaryKey tableName="user"/>
        <dropNotNullConstraint tableName="user" columnName="id"/>
    </changeSet>
    <changeSet id="1680067598533-2" author="georgerapeanu">
        <addNotNullConstraint tableName="manufacturer" columnName="id"/>
        <addPrimaryKey tableName="manufacturer" columnNames="id"/>

        <addNotNullConstraint tableName="product" columnName="manufacturer_id"/>
        <addNotNullConstraint tableName="product" columnName="id"/>
        <addPrimaryKey tableName="product" columnNames="id"/>

        <addNotNullConstraint tableName="review" columnName="product_id"/>
        <addNotNullConstraint tableName="review" columnName="user_id"/>
        <addPrimaryKey tableName="review" columnNames="user_id,product_id"/>

        <addNotNullConstraint tableName="user" columnName="id"/>
        <addPrimaryKey tableName="user" columnNames="id"/>

        <addForeignKeyConstraint baseColumnNames="user_id" baseTableName="review" constraintName="FKp62gdxif9h9dtdwcyf5b7gdi8" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="user" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="manufacturer_id" baseTableName="product" constraintName="FK9it4492m5g5mttbvqy9dd2ngh" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="manufacturer" validate="true"/>
        <addForeignKeyConstraint baseColumnNames="product_id" baseTableName="review" constraintName="FK8ldiblkvx92d9i5yn9qqeuk8j" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="product" validate="true"/>
    </changeSet>
</databaseChangeLog>
